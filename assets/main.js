// Main JavaScript for Geographic Journal Theme - Optimized
function switchNightMode(){const e=getCookie("night")||"0",t=document.querySelector(".navbar");"0"===e?(document.body.classList.add("night"),setCookie("night","1",365),t&&(t.style.backgroundColor="var(--dark-bg, #252627)"),console.log("夜间模式开启")):(document.body.classList.remove("night"),setCookie("night","0",365),t&&(t.style.backgroundColor=""),console.log("夜间模式关闭"))}function initNightMode(){const e=getCookie("night"),t=document.querySelector(".navbar");if(""===e){const e=new Date().getHours();e>21||e<5?(document.body.classList.add("night"),setCookie("night","1",365),t&&(t.style.backgroundColor="var(--dark-bg, #252627)"),console.log("夜间模式自动开启")):(document.body.classList.remove("night"),setCookie("night","0",365),t&&(t.style.backgroundColor=""),console.log("夜间模式自动关闭"))}else"0"===e?(document.body.classList.remove("night"),t&&(t.style.backgroundColor="")):"1"===e&&(document.body.classList.add("night"),t&&(t.style.backgroundColor="var(--dark-bg, #252627)"))}function setCookie(e,t,n){const o=new Date;o.setTime(o.getTime()+864e5*n),document.cookie=e+"="+t+";expires="+o.toUTCString()+";path=/"}function getCookie(e){const t=e+"=",n=document.cookie.split(";");for(let o=0;o<n.length;o++){let i=n[o];for(;" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return""}function initScrollEffects(){const e=document.querySelector(".navbar"),t=document.querySelector(".hero");if(!t)return;window.addEventListener("scroll",(function(){const n=window.pageYOffset,i=t.querySelector(".hero-background img"),o=document.body.classList.contains("night");i&&(i.style.transform="translateY("+.5*n+"px)"),o&&e?e.style.backgroundColor="var(--dark-bg, #252627)":e&&(n>100?e.style.backgroundColor="rgba(255,255,255,.98)":e.style.backgroundColor="rgba(255,255,255,.95)")}));const n=new IntersectionObserver((function(e){e.forEach((e=>{e.isIntersecting&&(e.target.style.opacity="1",e.target.style.transform="translateY(0)")}))}),{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".article-card, .archive-card").forEach((e=>{e.style.opacity="0",e.style.transform="translateY(20px)",e.style.transition="opacity .6s ease, transform .6s ease",n.observe(e)}))}function initNavigation(){const e=document.querySelector(".nav-menu");if(!e)return;function t(){if(document.querySelector(".mobile-menu-toggle"))return;const t=document.createElement("button");t.className="mobile-menu-toggle",t.innerHTML="☰",t.setAttribute("aria-label","Toggle menu"),t.addEventListener("click",(function(){e.classList.toggle("active"),this.innerHTML=e.classList.contains("active")?"✕":"☰",this.setAttribute("aria-expanded",e.classList.contains("active"))})),document.querySelector(".navbar .container").appendChild(t)}window.innerWidth<=768&&t(),window.addEventListener("resize",debounce((()=>{window.innerWidth<=768?t():(document.querySelector(".mobile-menu-toggle")?.remove(),e.classList.remove("active"))}),250))}function initArchiveFilter(){const e=document.querySelectorAll(".filter-btn"),t=document.querySelectorAll(".archive-card");if(0===e.length)return;e.forEach((e=>{e.addEventListener("click",(function(){const n=this.dataset.filter;e.forEach((e=>e.classList.remove("active"))),this.classList.add("active"),t.forEach((e=>{const t="all"===n||e.dataset.category===n;t?(e.style.display="block",setTimeout((()=>{e.style.opacity="1",e.style.transform="translateY(0)"}),50)):(e.style.opacity="0",e.style.transform="translateY(-10px)",setTimeout((()=>{e.style.display="none"}),300))}))}))}))}function initImageLazyLoading(){if("IntersectionObserver"in window){const t=document.querySelectorAll("img[data-src]"),e=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&(e.target.src=e.target.dataset.src,e.target.classList.remove("lazy"),this.unobserve(e.target))}))}));t.forEach((t=>e.observe(t)))}else document.querySelectorAll("img[data-src]").forEach((e=>{e.src=e.dataset.src}))}function initTypographyEffects(){document.querySelector(".post")&&addReadingProgress(),document.querySelector(".post-body")&&highlightCurrentSection()}function addReadingProgress(){const e=document.createElement("div");e.className="reading-progress",document.body.appendChild(e),window.addEventListener("scroll",(()=>{const t=document.body.scrollTop||document.documentElement.scrollTop,n=document.documentElement.scrollHeight-document.documentElement.clientHeight;e.style.width=t/n*100+"%"}))}function highlightCurrentSection(){const e=document.querySelectorAll(".post-body h2, .post-body h3");if(0===e.length)return;const t=Array.from(e).map((e=>({element:e,offset:e.offsetTop})));let n=t[0];window.addEventListener("scroll",(()=>{const e=window.pageYOffset+100;t.forEach((t=>{e>=t.offset&&(n=t)})),t.forEach((e=>e.element.classList.remove("current-section"))),n&&n.element.classList.add("current-section")}))}function debounce(e,t){let n;return function(...o){const i=()=>{clearTimeout(n),e(...o)};clearTimeout(n),n=setTimeout(i,t)}}document.addEventListener("DOMContentLoaded",(function(){initNightMode(),initScrollEffects(),initNavigation(),initArchiveFilter(),initImageLazyLoading(),initTypographyEffects()}));const additionalStyles=".reading-progress{position:fixed;top:0;left:0;width:0;height:3px;background-color:var(--primary-color,#fc0);z-index:9999;transition:width .1s ease}.current-section{color:var(--primary-color,#fc0)!important;transition:color .3s ease}.social-links{display:flex;flex-direction:column;gap:.5rem}.social-links a{display:flex;align-items:center;gap:.5rem;opacity:.8}.social-links a:hover{opacity:1}@media (max-width:768px){.mobile-menu-toggle{display:block;background:0;border:0;font-size:1.5rem;color:#333;cursor:pointer;padding:.5rem}.nav-menu{display:none;position:absolute;top:100%;left:0;right:0;background-color:#fff;flex-direction:column;padding:1rem;box-shadow:0 5px 15px rgba(0,0,0,.1);z-index:1000}.nav-menu.active{display:flex}.nav-menu a{padding:.75rem 0;border-bottom:1px solid #f0f0f0}.nav-menu a:last-child{border-bottom:0}body.night .mobile-menu-toggle{color:var(--dark-text,#f5f5f5)}body.night .nav-menu{background-color:var(--dark-bg,#252627)}body.night .nav-menu a{border-bottom-color:#444}.social-links{gap:.75rem}}@media (max-width:480px){.footer-content{grid-template-columns:1fr;gap:1.5rem}}";document.querySelector("#dynamic-styles")||((e=>{e.id="dynamic-styles",e.textContent=additionalStyles,document.head.appendChild(e)})(document.createElement("style")));function copyEmail(el){const email='zoudang@foxmail.com';navigator.clipboard.writeText(email).then(()=>{el.title='已复制';setTimeout(()=>el.title='点击复制邮箱',1500)})};